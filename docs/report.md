**Тема:** форматы файлов - бинарные – DICOM  
**ФИО:** Аникин Данила Андреевич  
**Дата:** 29.12.2023  
**Digital Imaging and Communications in Medicine (DICOM)** – стандарт обработки, 
хранения, передачи, печати и визуализации медицинских изображений.

### Цель создания  
До создания DICOM в сфере медицинских исследований отсутствовал общепринятый **стандарт** работы с цифровыми изображениями. Это вынуждало пользователей иметь дело с множеством форматов данных и преобразовывать данные из одного формата в другой.  

**Стандарт** DICOM определяет:  

**файловый уровень** — DICOM File (DICOM-файл) — объектный файл с теговой организацией для представления кадра изображения (или серии кадров) и сопровождающей или управляющей информации (в виде DICOM-тегов);  

**сетевой (коммуникационный) уровень** — DICOM Network Protocols (сетевой DICOM-протокол) — для передачи DICOM-файлов и управляющих DICOM-команд по сетям с поддержкой TCP/IP. (Larobina, 2023)  


### Терминология

**Информационная модель DICOM**

Пациент (patient) → Исследование (study) → Серия (series) → Изображение (кадр 
или серия кадров, image)

**Service Class User** – устройство-клиент, которое инициирует запрос

**Service Class Provider** – устройство, предоставляющее сервис

**Information Object Definition** – объектно-ориентированная абстрактная модель данных, используемая для указания информации об объектах реального мира. IOD не представляет собой конкретный экземпляр объекта реального мира, а скорее класс объектов реального мира, которые имеют одни и те же свойства.  
Например, MR Image – Объект МРТ-снимков.

**Service Group** – набор команд, которые можно запрашивать у SCP.

Примеры команд: Print (Печать), Storage (Хранение), Query/Retrieve (Получение 
объекта). 

**Service Object Pair** – комбинация команды (Service Group) и объекта (Information Object Definition), с которым эта команда будет выполняться.  
Например, SOP Class “MR Image Storage” = Storage + MR Image.

**Application Entities** – отдельный сервис DICOM, узел сети DICOM. (Medema)

![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/ecacd8d6-979c-4c48-8016-1536cd4ddea2)


### Формат файлов DICOM

Формат файла DICOM предоставляет средства для инкапсуляции в файл набора данных, представляющего экземпляр SOP, связанный с IOD DICOM. Как показано на рисунке, поток байтов набора данных помещается в файл после метаинформации файла DICOM. Каждый файл содержит один экземпляр SOP.

![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/39aca6ea-d50e-4eb6-b28b-1f5a4d00017b)

**Метаинформация файла** включает в себя идентификационную информацию об инкапсулированном наборе данных. Этот заголовок состоит из 128-байтовой преамбулы файла, за которой следует 4-байтовый префикс DICOM, за которым следуют метаэлементы файла, показанные в таблице. Этот заголовок должен присутствовать в каждом файле DICOM. (dicom.nema.org)

![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/3fba714a-a265-4010-92cd-44cabfff1197)
![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/f0ce3d1e-11fe-4b64-84da-6c30855b4e31)
![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/584124a2-166b-4872-9b77-7c5112b0a269)

### Структура IOD

![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/cad154a9-12ea-4b7a-99c1-bc9de39ecf28)

**Атрибуты** IOD описывают свойства экземпляра реального объекта. Связанные атрибуты сгруппированы в **модули**, которые представляют более высокий уровень семантики.

![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/79fb7ffd-b182-4b44-9da5-a2d17abd5671)
![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/3cb3d00b-735f-4579-9085-09bbcddee461)

**Тэг** – Определяет ключ атрибута/элемента данных

**Представление значения (VR)** – Определяет тип данных, используемый для кодирования значения (есть таблица типов для формата DICOM, например, PN – Person Name)

**Кратность значений (VM)** – Определяет, сколько значений может быть в атрибуте

**Модуль** – Архитектурное удобство, логическая группа атрибутов, относящихся к общей теме.

![image](https://github.com/Pandanila/misis2023f-22-01-anikin-d-a/assets/97802843/0e4fdaed-e7d1-4dd5-8780-c7208ef4abd3)

**Type:** 1 – обязательный, 2 – может быть пустым, если неизвестно, 3 – необязательный, 1С или 2С – условный.

### Работа с DICOM в C++

Наиболее оптимальный способ работать со стандартом DICOM - использование специализированных C++ библиотек. Например, это библиотека DCMTK.
В DCMTK входит программное обеспечение:
*	для проверки, создания и преобразования файлов изображений DICOM
*	для работы с носителями информации
*	для отправки и получения изображений через сетевое соединение
Пример создания dicom-файла с помощью библиотеки DCMTK приведен в прикрепленном файле.
